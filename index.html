<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jogo das Moedas ‚Äî Vers√£o Acess√≠vel</title>
  <style>
    :root {
      --bg: #ffffff;
      --fg: #111111;
      --accent: #0b5ed7;
      --accent-contrast: #ffffff;
      --ok: #198754;
      --err: #dc3545;
    }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Arial, sans-serif;
      color: var(--fg); background: var(--bg); line-height: 1.4;
    }
    .container { max-width: 1100px; margin: 0 auto; padding: 1rem; }
    header { margin-bottom: .5rem; }
    h1 { font-size: clamp(1.4rem, 2.5vw + 1rem, 2rem); margin: 0 0 .25rem; }
    p.lead { font-size: 1.1rem; margin: 0 0 .75rem; }

    .grid { display: grid; grid-template-columns: 1fr; gap: 1rem; }
    @media (min-width: 840px) { .grid { grid-template-columns: 1.1fr .9fr; } }

    .panel { border: 2px solid #e6e6e6; border-radius: 12px; padding: 1rem; }
    .coins {
      display: flex; flex-wrap: wrap; gap: .75rem; align-items: center; justify-content: center;
      min-height: 220px; padding: .5rem; background: #fafafa; border-radius: 10px;
    }
    .coins img { width: 72px; height: 72px; object-fit: contain; }
    .controls label { display: inline-block; margin-bottom: .25rem; font-weight: 600; }
    .controls input[type="text"] { font-size: 1.25rem; padding: .6rem .8rem; width: 100%; border-radius: 10px; border: 2px solid #cfcfcf; }
    .btnrow { display: flex; flex-wrap: wrap; gap: .6rem; margin-top: .8rem; }
    .btn { cursor: pointer; border: 0; padding: .7rem 1rem; border-radius: 999px; font-weight: 700; font-size: 1rem; }
    .btn.primary { background: var(--accent); color: var(--accent-contrast); }
    .btn.secondary { background: #6c757d; color: #fff; }
    .btn.warning { background: #ffc107; color: #111; }
    .btn.ghost { background: transparent; border: 2px solid #ccc; }

    .result { margin-top: .8rem; border-radius: 12px; padding: .75rem 1rem; font-weight: 600; }
    .result.ok { background: #e7f6ee; border: 2px solid var(--ok); color: #0f5132; }
    .result.err { background: #f8d7da; border: 2px solid var(--err); color: #842029; }

    .hint { margin-top: .5rem; font-size: .98rem; background: #fff7e6; border: 2px dashed #ffcd39; color: #664d03; padding: .6rem .8rem; border-radius: 10px; display: none; }
    .hint strong { white-space: nowrap; }

    .sr-only { position: absolute !important; height: 1px; width: 1px; overflow: hidden; clip: rect(1px, 1px, 1px, 1px); white-space: nowrap; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Vamos brincar de dinheiro? üí∞</h1>
      <p class="lead">Some o valor total das moedas mostradas e digite o resultado. Voc√™ pode usar v√≠rgula ou ponto nos centavos (ex.: <em>3,75</em> ou <em>3.75</em>).</p>
    </header>

    <div class="grid">
      <!-- √Årea das moedas -->
      <section class="panel" aria-labelledby="titulo-moedas">
        <h2 id="titulo-moedas" style="margin-top:0">Moedas exibidas</h2>
        <div id="dvMoedas" class="coins" role="group" aria-label="Conjunto de moedas"></div>
        <button id="btnLerMoedas" type="button" class="btn ghost" aria-describedby="dica-voz-moedas">Ler moedas em voz alta</button>
        <p id="dica-voz-moedas" class="sr-only">Usa s√≠ntese de voz do navegador, se dispon√≠vel.</p>
      </section>

      <!-- √Årea de intera√ß√£o -->
      <section class="panel" aria-labelledby="titulo-interacao">
        <h2 id="titulo-interacao" style="margin-top:0">Sua resposta</h2>
        <form id="frm" class="controls" novalidate>
          <label for="inSoma">A soma das moedas √© (R$):</label>
          <input id="inSoma" name="inSoma" type="text" inputmode="decimal" autocomplete="off" placeholder="Ex.: 2,35" aria-describedby="ajuda-soma" required />
          <div id="ajuda-soma">Dica: voc√™ pode digitar com v√≠rgula (,) ou ponto (.).</div>

          <div class="btnrow">
            <button id="btnConferir" class="btn primary" type="submit">Conferir resposta</button>
            <button id="btnNovas" class="btn secondary" type="button">Exibir novas moedas</button>
            <button id="btnDica" class="btn warning" type="button" aria-expanded="false" aria-controls="boxDica">Mostrar dica</button>
            <button id="btnLerResultado" class="btn ghost" type="button">Ler resultado</button>
          </div>
        </form>
        <div id="boxResultado" class="result" role="status" aria-live="polite" aria-atomic="true" style="display:none"></div>
        <div id="boxDica" class="hint" hidden></div>
      </section>
    </div>
  </div>

  <script>
    // Configura√ß√£o das moedas (valor, arquivo de imagem, r√≥tulos)
    const COINS = [
      { value: 1.00, file: "1_00.jpg", alt: "Moeda de um real", cls: "moeda1-00" },
      { value: 0.50, file: "0_50.jpg", alt: "Moeda de cinquenta centavos", cls: "moeda0-50" },
      { value: 0.25, file: "0_25.jpg", alt: "Moeda de vinte e cinco centavos", cls: "moeda0-25" },
      { value: 0.10, file: "0_10.jpg", alt: "Moeda de dez centavos", cls: "moeda0-10" },
      { value: 0.05, file: "0_05.jpg", alt: "Moeda de cinco centavos", cls: "moeda0-05" }
    ];

    const dvMoedas = document.getElementById('dvMoedas');
    const frm = document.getElementById('frm');
    const inSoma = document.getElementById('inSoma');
    const boxResultado = document.getElementById('boxResultado');
    const boxDica = document.getElementById('boxDica');
    const btnDica = document.getElementById('btnDica');
    const btnNovas = document.getElementById('btnNovas');
    const btnConferir = document.getElementById('btnConferir');
    const btnLerMoedas = document.getElementById('btnLerMoedas');
    const btnLerResultado = document.getElementById('btnLerResultado');

    // Estado atual (quantidades)
    let quantidades = { };

    function moedaBRL(n) {
      return n.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    function normalizarEntrada(txt) {
      // Aceitar v√≠rgula ou ponto, remover espa√ßos
      if (typeof txt !== 'string') return NaN;
      const t = txt.trim().replace(',', '.');
      // Evitar m√∫ltiplos pontos
      if ((t.match(/\./g) || []).length > 1) return NaN;
      const val = Number(t);
      return Number.isFinite(val) ? Math.round(val * 100) / 100 : NaN;
    }

    function gerarAleatorio(min, max) { // inclusive
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function anunciar(texto) {
      try {
        if ('speechSynthesis' in window) {
          const u = new SpeechSynthesisUtterance(texto);
          u.lang = 'pt-BR';
          window.speechSynthesis.cancel();
          window.speechSynthesis.speak(u);
        }
      } catch (_) { /* silencioso */ }
    }

    function limparResultado() {
      boxResultado.style.display = 'none';
      boxResultado.textContent = '';
      boxResultado.className = 'result';
    }

    function mostrarResultado(msg, ok) {
      boxResultado.textContent = msg;
      boxResultado.className = 'result ' + (ok ? 'ok' : 'err');
      boxResultado.style.display = 'block';
    }

    function atualizarDica() {
      const linhas = [];
      COINS.forEach(c => {
        const q = quantidades[c.value] || 0;
        linhas.push(`${q} √ó ${moedaBRL(c.value)}`);
      });
      const texto = `Quantidades: ${linhas.join(' ‚Ä¢ ')}.`;
      boxDica.textContent = texto;
    }

    function renderizarMoedas() {
      dvMoedas.innerHTML = '';
      const frag = document.createDocumentFragment();
      COINS.forEach(c => {
        const q = quantidades[c.value] || 0;
        for (let i = 0; i < q; i++) {
          const img = document.createElement('img');
          img.src = 'img/' + c.file; // ajuste o caminho conforme sua pasta
          img.alt = c.alt;
          img.className = c.cls;
          img.setAttribute('data-value', c.value.toFixed(2));
          img.setAttribute('role', 'img');
          img.setAttribute('aria-label', c.alt);
          frag.appendChild(img);
        }
      });
      dvMoedas.appendChild(frag);
    }

    function sortearMoedas() {
      quantidades = {};
      COINS.forEach(c => {
        // Para p√∫blico com DI, limitar a 1‚Äì4 por tipo reduz sobrecarga cognitiva
        quantidades[c.value] = gerarAleatorio(1, 4);
      });
      renderizarMoedas();
      atualizarDica();
      limparResultado();
      inSoma.value = '';
      inSoma.focus();
    }

    function totalMoedas() {
      let total = 0;
      COINS.forEach(c => {
        total += (quantidades[c.value] || 0) * c.value;
      });
      return Math.round(total * 100) / 100; // duas casas
    }

    // Eventos
    window.addEventListener('load', sortearMoedas);

    frm.addEventListener('submit', (e) => {
      e.preventDefault();
      const val = normalizarEntrada(inSoma.value);
      if (!Number.isFinite(val)) {
        mostrarResultado('Digite um n√∫mero v√°lido. Ex.: 1,50', false);
        anunciar('Digite um n√∫mero v√°lido');
        inSoma.focus();
        return;
      }
      const tot = totalMoedas();
      const ok = Math.abs(val - tot) < 0.001;
      if (ok) {
        mostrarResultado(`Parab√©ns! Voc√™ acertou. Total correto: ${moedaBRL(tot)}.`, true);
        anunciar('Parab√©ns! Voc√™ acertou.');
        btnConferir.disabled = true;
      } else {
        mostrarResultado(`N√£o foi desta vez. O total correto √© ${moedaBRL(tot)}.`, false);
        anunciar(`Resposta incorreta. O total correto √© ${moedaBRL(tot)}.`);
        btnConferir.disabled = true;
      }
    });

    btnNovas.addEventListener('click', () => {
      btnConferir.disabled = false;
      sortearMoedas();
    });

    btnDica.addEventListener('click', () => {
      const expanded = btnDica.getAttribute('aria-expanded') === 'true';
      btnDica.setAttribute('aria-expanded', String(!expanded));
      if (expanded) {
        boxDica.hidden = true;
        boxDica.style.display = 'none';
        btnDica.textContent = 'Mostrar dica';
      } else {
        atualizarDica();
        boxDica.hidden = false;
        boxDica.style.display = 'block';
        btnDica.textContent = 'Esconder dica';
      }
    });

    btnLerMoedas.addEventListener('click', () => {
      const partes = COINS.map(c => `${quantidades[c.value] || 0} de ${moedaBRL(c.value)}`);
      anunciar(`Moedas na tela: ${partes.join(', ')}.`);
    });

    btnLerResultado.addEventListener('click', () => {
      if (boxResultado.style.display === 'block') anunciar(boxResultado.textContent);
    });
  </script>
</body>
</html>
